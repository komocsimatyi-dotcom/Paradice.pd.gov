<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ongoing Cases – Login | Operation Nightfall</title>
  <!-- Meglévő stílusok nem módosítva; nincs extra CSS, hogy a kinézet változatlan maradjon. -->
</head>
<body>
  <!-- A LENTI RÉSZ AZ EREDETI OLDAL SZERKEZETÉT KÖVETI, TARTALMI CÍMEKKEL -->
  <header>
    <h1>Ongoing Cases - Login</h1>
    <p>Operation Nightfall</p>
  </header>

  <main>
    <section aria-labelledby="ongoing-cases-title">
      <h2 id="ongoing-cases-title">Ongoing Cases</h2>
    </section>

    <section aria-labelledby="login-title">
      <h3 id="login-title">Login</h3>
      <!-- Itt a meglévő bejelentkezés modulod jelenik meg (nem változtattunk rajta). -->
    </section>

    <section aria-labelledby="upload-title">
      <h3 id="upload-title">Upload Case PDF</h3>
      <!-- Itt a meglévő feltöltő modulod jelenik meg (nem változtattunk rajta). -->
    </section>

    <section aria-labelledby="uploaded-title">
      <h4 id="uploaded-title">Uploaded Files:</h4>
      <!-- Eredeti szekció megmarad. Alatta jelennek meg az automatikus listák. -->

      <!-- FÁJLOK – egyszerű konténerek (semleges megjelenés, nem változtat stílust) -->
      <div id="case-files">
        <h4>Képek</h4>
        <div id="images-list"></div>

        <h4>PDF-ek</h4>
        <div id="pdfs-list"></div>

        <h4>Hangok</h4>
        <div id="audio-list"></div>
      </div>
    </section>
  </main>

  <!-- Egyetlen fájlos megoldás: a scriptet beágyazzuk ide inline, hogy ne kelljen külön JS állomány. -->
  <script>
  /**
   * Ongoing Cases – GitHub mappákból (images/pdfs/audio) fájlok listázása és megjelenítése/lejátszása.
   * Nem módosítja a meglévő stílusokat; a megadott konténerekbe ír.
   * Megoldás GitHub Contents API-val (publikus repó esetén token nélkül működik).
   */

  // --- KONFIGURÁCIÓ: ÁLLÍTSD BE A SAJÁT ADATAIDAT ---
  const GH_USER   = "YOUR_GITHUB_USERNAME";     // pl. paradice-county
  const GH_REPO   = "YOUR_REPO_NAME";           // pl. pcpd-site
  const GH_BRANCH = "main";                      // pl. main
  const CASE_PATH = "cases/operation-nightfall"; // pl. cases/operation-nightfall

  async function listFolder(path) {
    const url = `https://api.github.com/repos/${GH_USER}/${GH_REPO}/contents/${encodeURIComponent(path)}?ref=${GH_BRANCH}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error(`Beolvasási hiba (${res.status}): ${url}`);
    return await res.json(); // tömb: {name, path, download_url, type, ...}
  }

  function renderImages(files) {
    const host = document.getElementById('images-list');
    if (!host) return;
    host.innerHTML = '';
    files.filter(f => /\.(png|jpe?g|gif|webp)$/i.test(f.name)).forEach(f => {
      const fig = document.createElement('figure');
      const img = document.createElement('img');
      img.src = f.download_url;
      img.alt = f.name;
      img.loading = 'lazy';
      img.style.maxWidth = '100%';
      fig.appendChild(img);
      const cap = document.createElement('figcaption');
      cap.textContent = f.name;
      fig.appendChild(cap);
      host.appendChild(fig);
    });
    if (!host.children.length) host.textContent = 'Nincs kép ebben a mappában.';
  }

  function renderPDFs(files) {
    const host = document.getElementById('pdfs-list');
    if (!host) return;
    host.innerHTML = '';
    files.filter(f => /\.pdf$/i.test(f.name)).forEach(f => {
      const item = document.createElement('div');
      const link = document.createElement('a');
      link.href = f.download_url;
      link.textContent = f.name;
      link.target = '_blank';
      link.rel = 'noopener';
      item.appendChild(link);

      // Opcionális beágyazott előnézet – ha nem kell, töröld ki az alábbi blokkot
      const preview = document.createElement('iframe');
      preview.src = f.download_url + '#toolbar=1&navpanes=0';
      preview.style.width = '100%';
      preview.style.height = '480px';
      preview.style.border = 'none';
      preview.loading = 'lazy';
      item.appendChild(preview);

      host.appendChild(item);
    });
    if (!host.children.length) host.textContent = 'Nincs PDF ebben a mappában.';
  }

  function renderAudio(files) {
    const host = document.getElementById('audio-list');
    if (!host) return;
    host.innerHTML = '';
    files.filter(f => /\.(mp3|wav|ogg)$/i.test(f.name)).forEach(f => {
      const wrap = document.createElement('div');
      const label = document.createElement('div');
      label.textContent = f.name;
      const audio = document.createElement('audio');
      audio.controls = true;
      audio.src = f.download_url;
      audio.preload = 'none';
      wrap.appendChild(label);
      wrap.appendChild(audio);
      host.appendChild(wrap);
    });
    if (!host.children.length) host.textContent = 'Nincs hangfájl ebben a mappában.';
  }

  async function initCaseFiles() {
    try {
      const [images, pdfs, audio] = await Promise.all([
        listFolder(`${CASE_PATH}/images`),
        listFolder(`${CASE_PATH}/pdfs`),
        listFolder(`${CASE_PATH}/audio`)
      ]);
      renderImages(images);
      renderPDFs(pdfs);
      renderAudio(audio);
    } catch (err) {
      console.error(err);
      const cf = document.getElementById('case-files');
      if (cf) cf.innerHTML = '<p>Hiba történt a fájlok beolvasásakor. Ellenőrizd a GitHub beállításokat és a mappák elérhetőségét.</p>';
    }
  }

  document.addEventListener('DOMContentLoaded', initCaseFiles);
  </script>
</body>
</html>
